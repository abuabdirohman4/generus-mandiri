{"id":"sm-04g","title":"Bug: Filter halaman organisasi tidak berjalan","description":"## ğŸ› Problem\nFilter pada halaman organisasi tidak berfungsi dengan baik.\n\n## ğŸ“ Location\nHalaman: /organisasi\n\n## ğŸ” Expected Behavior\nFilter seharusnya dapat menyaring data organisasi berdasarkan kriteria yang dipilih (Daerah, Desa, Kelompok).\n\n## âŒ Current Behavior\nFilter tidak berjalan/tidak memberikan hasil yang diharapkan.\n\n## ğŸ§ª Steps to Reproduce\n1. Buka halaman Organisasi\n2. Coba gunakan filter (Daerah/Desa/Kelompok)\n3. Observe: Filter tidak bekerja\n\n## ğŸ”§ Possible Causes\n- Filter logic tidak terhubung dengan data fetching\n- State management untuk filter tidak ter-update\n- Query parameters tidak ter-apply ke API call\n- RLS policy issue\n\n## ğŸ’¡ Investigation Needed\n- [ ] Check filter state management (Zustand/React state)\n- [ ] Verify API calls include filter parameters\n- [ ] Test filter with different organizational levels\n- [ ] Check console for errors\n- [ ] Review RLS policies for organisasi tables\n\n## ğŸ“ Related Files\n- src/app/(admin)/organisasi/page.tsx\n- src/app/(admin)/organisasi/components/\n- src/app/(admin)/organisasi/hooks/\n- src/app/(admin)/organisasi/stores/\n\n## ğŸ·ï¸ Version\nv1.10.2","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T08:22:13.344661+07:00","created_by":"abuabdirohman","updated_at":"2026-01-10T08:22:13.344661+07:00","labels":["bug","filter","organisasi","ui"]}
{"id":"sm-37l","title":"Document unit testing strategy in CLAUDE.md","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:10.403811+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:32:10.403811+07:00","dependencies":[{"issue_id":"sm-37l","depends_on_id":"sm-qrt","type":"blocks","created_at":"2026-02-10T08:32:49.584523+07:00","created_by":"abuabdirohman"}]}
{"id":"sm-6gn","title":"Write tests for utility functions (Priority 1)","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:12.306887+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:32:12.306887+07:00","dependencies":[{"issue_id":"sm-6gn","depends_on_id":"sm-qrt","type":"blocks","created_at":"2026-02-10T08:32:58.235922+07:00","created_by":"abuabdirohman"}]}
{"id":"sm-8yf","title":"Feature: Student management actions (Archive, Transfer, Soft Delete, Hard Delete) with teacher permissions","description":"Implement comprehensive student management actions including archive/unarchive, transfer between classes, soft delete (restore-able), and hard delete (permanent) with proper role-based permissions.\n\n## ğŸ¯ Objectives\n- Provide flexible student lifecycle management\n- Enable proper data retention and cleanup\n- Support teacher-level student management with restrictions\n- Maintain data integrity and audit trail\n\n## ğŸ“‹ Features to Implement\n\n### 1. Archive/Unarchive Students\n**Purpose**: Temporarily hide students from active lists (e.g., graduated, on leave)\n**Database**: Add `archived_at` timestamp column to `students` table\n**Permissions**:\n- âœ… Superadmin: Can archive/unarchive any student\n- âœ… Admin (Daerah/Desa/Kelompok): Can archive/unarchive students in their hierarchy\n- âœ… Teacher: Can archive students in their assigned classes only\n- âŒ Student: No access\n\n**UI**:\n- Add \"Archive\" button in student list actions\n- Add filter toggle to show/hide archived students\n- Show archived badge on student cards\n- \"Unarchive\" option in archived student context menu\n\n**Business Rules**:\n- Archived students don't appear in default lists\n- Archived students can't be assigned to new classes\n- Archived students are excluded from attendance by default\n- Can be filtered to show in reports (\"Include archived\")\n\n### 2. Transfer Students Between Classes\n**Purpose**: Move students to different classes (promotion, reassignment)\n**Database**: Update `student_classes` junction table\n**Permissions**:\n- âœ… Superadmin: Transfer to any class\n- âœ… Admin: Transfer within their organizational hierarchy\n- âœ… Teacher: Transfer between their own assigned classes only\n- âŒ Student: No access\n\n**UI**:\n- \"Transfer Student\" modal with class selector\n- Batch transfer support (multiple students â†’ one class)\n- Show source and destination class clearly\n- Confirmation dialog with impact summary\n\n**Business Rules**:\n- Can only transfer to classes in same/lower organizational level\n- Maintains attendance history (student_id unchanged)\n- Updates `student_classes` mappings\n- Optionally notify teachers of both classes\n\n### 3. Soft Delete (Restorable)\n**Purpose**: Mark students as deleted but keep data for recovery\n**Database**: Add `deleted_at` timestamp column to `students` table\n**Permissions**:\n- âœ… Superadmin: Can soft delete any student\n- âœ… Admin: Can soft delete students in their hierarchy\n- âš ï¸  Teacher: Can soft delete ONLY if granted `can_delete_students` permission\n- âŒ Student: No access\n\n**UI**:\n- \"Delete\" button (with confirmation)\n- \"Restore\" option in deleted students view\n- Separate \"Deleted Students\" section in UI\n- Visual indicator (strikethrough, red badge)\n\n**Business Rules**:\n- Soft deleted students don't appear in any active lists\n- Excluded from attendance, reports, and class assignments\n- Can be restored within retention period (e.g., 90 days)\n- After retention period â†’ auto hard delete (background job)\n\n### 4. Hard Delete (Permanent)\n**Purpose**: Permanently remove student data (GDPR compliance, data cleanup)\n**Database**: Delete row from `students` table + cascade to related tables\n**Permissions**:\n- âœ… Superadmin: Can hard delete any student\n- âŒ Admin: Cannot hard delete (only soft delete)\n- âŒ Teacher: Cannot hard delete\n- âŒ Student: No access\n\n**UI**:\n- Only available in \"Deleted Students\" view\n- Requires double confirmation (\"Are you SURE? This is PERMANENT.\")\n- Shows impact summary (attendance logs, report cards affected)\n- Optionally requires admin password re-entry\n\n**Business Rules**:\n- Must be soft deleted first (can't hard delete active students)\n- Cascade deletes:\n  - `student_classes` mappings\n  - `attendance_logs` (or archive to separate table)\n  - `rapot_data` (or anonymize)\n- Cannot be undone\n- Logged in audit trail\n\n## ğŸ—„ï¸ Database Schema Changes\n\n```sql\n-- Add columns to students table\nALTER TABLE students \n  ADD COLUMN archived_at TIMESTAMPTZ,\n  ADD COLUMN deleted_at TIMESTAMPTZ;\n\n-- Add index for faster queries\nCREATE INDEX idx_students_archived ON students(archived_at) WHERE archived_at IS NOT NULL;\nCREATE INDEX idx_students_deleted ON students(deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- Add teacher permission column to profiles table\nALTER TABLE profiles \n  ADD COLUMN can_delete_students BOOLEAN DEFAULT FALSE;\n```\n\n## ğŸ”’ RLS Policies Update\n\n```sql\n-- Students are visible if NOT deleted (unless explicitly querying deleted)\nCREATE POLICY \"students_visible_if_not_deleted\"\n  ON students FOR SELECT\n  USING (deleted_at IS NULL OR auth.uid() IN (\n    SELECT id FROM profiles WHERE role = 'superadmin'\n  ));\n\n-- Archived students are visible but marked\nCREATE POLICY \"archived_students_visible\"\n  ON students FOR SELECT\n  USING (TRUE); -- Let application handle archived filtering\n```\n\n## ğŸ› ï¸ Implementation Tasks\n\n### Backend (Server Actions)\n1. [ ] Create migration for database schema changes\n2. [ ] Implement `archiveStudent(studentId, userId)` server action\n3. [ ] Implement `unarchiveStudent(studentId, userId)` server action\n4. [ ] Implement `transferStudent(studentId, fromClassId, toClassId, userId)` server action\n5. [ ] Implement `softDeleteStudent(studentId, userId)` server action\n6. [ ] Implement `restoreStudent(studentId, userId)` server action\n7. [ ] Implement `hardDeleteStudent(studentId, userId, confirmToken)` server action\n8. [ ] Add permission checks in each action (use `canAccessFeature` from accessControlServer)\n9. [ ] Update `getAllStudents()` to filter out deleted students by default\n10. [ ] Add `getDeletedStudents()` and `getArchivedStudents()` actions\n\n### Frontend (UI Components)\n11. [ ] Add \"Archive\" action in student list dropdown\n12. [ ] Create `TransferStudentModal` component\n13. [ ] Create `DeleteStudentConfirmDialog` component (soft delete)\n14. [ ] Create `HardDeleteConfirmDialog` component (double confirmation)\n15. [ ] Add \"Show Archived\" toggle filter in student list\n16. [ ] Add \"Deleted Students\" tab/section\n17. [ ] Update student cards with archive/delete badges\n18. [ ] Add batch actions toolbar (archive/transfer multiple)\n\n### Access Control\n19. [ ] Update `canAccessFeature()` to support:\n    - `can_archive_student`\n    - `can_transfer_student`\n    - `can_soft_delete_student`\n    - `can_hard_delete_student`\n20. [ ] Add `can_delete_students` permission UI in admin/teacher profile editor\n21. [ ] Implement teacher class boundary checks (can only manage their students)\n\n### Testing\n22. [ ] Test archive/unarchive with all roles\n23. [ ] Test transfer between classes (same org, cross org)\n24. [ ] Test soft delete + restore flow\n25. [ ] Test hard delete with cascade effects\n26. [ ] Test teacher permissions (with and without `can_delete_students`)\n27. [ ] Test batch operations (multiple students)\n28. [ ] Test edge cases (archived + deleted states)\n\n## ğŸ¨ UI/UX Considerations\n\n**Student List Actions Dropdown**:\n```\nğŸ“ Edit Student\nğŸ“‹ View Details\nâ¡ï¸  Transfer to Class...\nğŸ“¦ Archive Student\nğŸ—‘ï¸  Delete Student (if permitted)\n```\n\n**Archived Student Badge**:\n```\n[Student Card]\n  ğŸ“¦ ARCHIVED\n  Name: John Doe\n  Class: Pra Nikah A\n  [Unarchive] [Delete]\n```\n\n**Deleted Students Section**:\n```\nğŸ—‘ï¸ Deleted Students (Restorable)\n  [Show] [Hide]\n  \n  - Jane Smith (Deleted 5 days ago) [Restore] [Permanently Delete]\n  - Bob Johnson (Deleted 15 days ago) [Restore] [Permanently Delete]\n```\n\n## ğŸ“Š Success Metrics\n\n- âœ… All 4 actions work for superadmin\n- âœ… Admins can archive/transfer/soft delete within hierarchy\n- âœ… Teachers can only manage their assigned class students\n- âœ… Hard delete requires superadmin + double confirmation\n- âœ… Archived students excluded from default lists\n- âœ… Deleted students can be restored within retention period\n- âœ… No orphaned data after hard delete\n- âœ… Audit trail logs all delete actions\n\n## ğŸš¨ Edge Cases to Handle\n\n1. **Archive archived student** â†’ Show \"Already archived\" message\n2. **Transfer deleted student** â†’ Not allowed, must restore first\n3. **Hard delete without soft delete** â†’ Not allowed, enforce workflow\n4. **Delete student with active attendance** â†’ Warn about data loss\n5. **Teacher deletes student without permission** â†’ Show access denied\n6. **Batch transfer to non-existent class** â†’ Validate class exists and accessible\n7. **Restore student to deleted class** â†’ Handle gracefully (maybe unassign from class)\n\n## ğŸ”— Related Files\n\n**Server Actions**:\n- `src/app/(admin)/users/siswa/actions.ts` (add new actions)\n\n**Components**:\n- `src/app/(admin)/users/siswa/components/StudentList.tsx` (add action buttons)\n- `src/app/(admin)/users/siswa/components/TransferStudentModal.tsx` [NEW]\n- `src/app/(admin)/users/siswa/components/DeleteConfirmDialog.tsx` [NEW]\n\n**Utilities**:\n- `src/lib/accessControlServer.ts` (add new permission checks)\n\n**Database**:\n- `supabase/migrations/` (add migration files)\n\n## ğŸ“ Notes\n\n- Consider GDPR requirements for data retention and deletion\n- Implement audit logging for all delete actions\n- Consider notification system (email teacher when student transferred)\n- Add \"Restore all\" batch action for deleted students\n- Consider auto-archive after X months of inactivity\n- Add export feature before hard delete (\"Download student data\")\n\n## ğŸ·ï¸ Related Issues\nNone yet - this is the foundational feature for student lifecycle management.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-04T21:17:45.025032+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:54:10.991128+07:00"}
{"id":"sm-8yt","title":"Bug: DataFilter layout for 3 filters not aligned properly for admin desa","description":"\n## Problem\nWhen admin_desa users view pages with DataFilter showing 3 filters (e.g., Kelompok, Kelas, Jenis Kelamin), the layout is not properly aligned. The filters appear in different rows with inconsistent widths.\n\n## Current Behavior\n- All 3 filters appear on separate rows\n- Filter widths are not equal\n- Layout looks messy and unprofessional\n\n## Expected Behavior\n- 2 filters on top row (equal width)\n- 1 filter on bottom row (full width on mobile, equal width on desktop)\n- All filters should be aligned and have consistent spacing\n\n## Location\nFile: src/components/shared/DataFilter.tsx\nLines: 570-598\n\n## Current Code Issue\nLine 576 uses `grid-cols-2 md:grid-cols-4` for filterCount 2-4, which doesn't handle 3 filters properly.\nThe `getFilterClass` function attempts to fix this with col-span, but the base grid is incorrect.\n\n## Attempted Fix (Reverted)\nChanged line 576 to separate cases:\n- filterCount === 2: grid-cols-2 md:grid-cols-4\n- filterCount === 3: grid-cols-2 md:grid-cols-3\n- filterCount === 4: grid-cols-2 md:grid-cols-4\n\nBut this was reverted by linter/prettier.\n\n## Solution Needed\nNeed to implement proper grid layout for 3 filters that:\n1. Works on mobile (2 cols, last spans 2)\n2. Works on desktop (3 equal cols)\n3. Survives linter/prettier formatting\n","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-04T21:16:35.534343+07:00","created_by":"abuabdirohman","updated_at":"2026-02-04T21:16:35.534343+07:00"}
{"id":"sm-a0y","title":"Refactor: Optimize absensi/actions.ts (2215 â†’ ~900 lines)","description":"Mengurangi kompleksitas dan duplikasi kode di src/app/(admin)/absensi/actions.ts dengan memecah logika berulang menjadi utility functions yang reusable.\n\n## ğŸ¯ Objectives\n- Reduce from 2215 lines to ~900 lines (-59%)\n- Eliminate ~1300 lines of duplicated code (-96%)\n- Split getMeetingsWithStats (986 lines â†’ ~200 lines per function)\n- Improve testability and maintainability\n\n## ğŸ“Š Problem Analysis\n\n### Duplicated Code Identified:\n1. **Data Transformation Logic** (~360 lines duplicate)\n   - Transform array to object (kelompok/desa/daerah): 12x repetitions\n   - Build class names array: 6x repetitions\n   - Build allClasses array: 4x repetitions\n\n2. **Filter Logic** (~200 lines duplicate)\n   - Teacher class filtering: 3x repetitions\n   - Admin hierarchy filtering: 3x repetitions\n   - Pengajar access logic: 4x repetitions\n\n3. **Stats Calculation** (~300 lines duplicate)\n   - Attendance percentage calculation: 3x repetitions\n   - Student filtering by role: 3x repetitions\n   - Stats enrichment: 3x repetitions\n\n4. **Query Patterns** (~150 lines duplicate)\n   - Fetch classes with hierarchy: 6x repetitions\n   - Build class maps: 5x repetitions\n   - Fetch student-class mappings: 3x repetitions\n\n5. **Auth \u0026 Validation** (~100 lines duplicate)\n   - User + profile fetch: 8x repetitions\n   - Teacher class validation: 2x repetitions\n   - Student validation: 3x repetitions\n\n## ğŸ”§ Implementation Phases\n\n### Phase 1: Extract Data Transformation Utilities (Reduction: ~310 lines)\n**Create:** src/lib/utils/dataTransformers.ts\n**Functions:**\n- transformClassWithHierarchy(classData)\n- transformMeetingClasses(meeting)\n- buildAllClassesArray(meeting, allClassesMap)\n- buildClassNamesArray(meeting, classNameMap)\n\n### Phase 2: Extract Query Helpers (Reduction: ~140 lines)\n**Create:** src/lib/utils/queryHelpers.ts\n**Functions:**\n- fetchClassesWithHierarchy(supabase, classIds)\n- buildClassMaps(classesData)\n- fetchStudentClassMappings(supabase, studentIds)\n\n### Phase 3: Extract Meeting Filter Logic (Reduction: ~340 lines)\n**Create:** src/app/(admin)/absensi/utils/meetingFilters.ts\n**Functions:**\n- filterMeetingsByTeacherClasses(meetings, teacherClassIds, ...)\n- filterMeetingsByAdminLevel(meetings, profile, ...)\n- checkPengajarAccess(meeting, teacherKelompokIds, classDetailsMap)\n\n### Phase 4: Extract Stats Calculation (Reduction: ~400 lines)\n**Create:** src/app/(admin)/absensi/utils/statsCalculators.ts\n**Functions:**\n- calculateMeetingStats(meeting, attendanceByMeeting, relevantStudentIds)\n- processRoleBasedStudentFilter(meeting, profile, ...)\n- enrichMeetingsWithStats(meetings, attendanceByMeeting, ...)\n\n### Phase 5: Extract Auth \u0026 Validation (Reduction: ~140 lines)\n**Create:** src/app/(admin)/absensi/utils/authHelpers.ts\n**Functions:**\n- getCurrentUserWithProfile(supabase, fields?)\n- validateTeacherClasses(adminClient, teacherId, classIds)\n- validateStudentSelection(adminClient, classIds, studentIds)\n\n### Phase 6: Split getMeetingsWithStats (Reduction: ~200 lines)\n**Create:** src/app/(admin)/absensi/utils/meetingQueries.ts\n**Structure:**\n- getMeetingsWithStats() - Main orchestrator (~100 lines)\n- getTeacherMeetingsWithStats() - Teacher-specific (~200 lines)\n- getAdminMeetingsWithStats() - Admin-specific (~180 lines)\n- getFallbackMeetingsWithStats() - Fallback (~100 lines)\n\n### Phase 7: Refactor actions.ts\n**Update all functions to use new utilities:**\n- createMeeting - Use authHelpers \u0026 validation\n- getMeetingById - Use dataTransformers\n- updateMeeting - Use authHelpers \u0026 validation\n- getMeetingsWithStats - Import from meetingQueries\n- getStudentsFromSnapshot - Use dataTransformers\n\n## ğŸ“‚ New File Structure\nsrc/lib/utils/\nâ”œâ”€â”€ dataTransformers.ts [NEW - ~150 lines]\nâ”œâ”€â”€ queryHelpers.ts [NEW - ~120 lines]\n\nsrc/app/(admin)/absensi/utils/\nâ”œâ”€â”€ authHelpers.ts [NEW - ~100 lines]\nâ”œâ”€â”€ meetingFilters.ts [NEW - ~200 lines]\nâ”œâ”€â”€ statsCalculators.ts [NEW - ~180 lines]\nâ”œâ”€â”€ meetingQueries.ts [NEW - ~150 lines]\n\nsrc/app/(admin)/absensi/\nâ””â”€â”€ actions.ts [REFACTORED - ~900 lines]\n\n**Total New Files:** 6\n**Total New LOC:** ~900 lines (reusable utilities)\n**Total Removed LOC:** ~1300 lines (duplications)\n**Net Reduction:** -400 lines + better modularity\n\n## âœ… Acceptance Criteria\n- [ ] No duplicated logic (\u003c 50 lines duplication)\n- [ ] All functions \u003c 200 lines\n- [ ] All utilities have TypeScript interfaces\n- [ ] All utilities have JSDoc comments\n- [ ] All existing tests pass\n- [ ] Unit tests for new utility functions\n- [ ] No performance regression\n- [ ] Type checking passes (npm run type-check)\n- [ ] No new ESLint warnings\n- [ ] All public API signatures unchanged\n- [ ] Existing SWR hooks still work\n\n## ğŸ“Š Success Metrics\n| Metric | Before | After | Target |\n|--------|--------|-------|--------|\n| Total LOC (actions.ts) | 2215 | ~900 | -59% |\n| Duplicated code | ~1300 | ~50 | -96% |\n| Longest function | 986 lines | ~200 lines | -80% |\n| Cyclomatic complexity | High | Low | âœ… |\n| Utility files | 3 | 9 | Modular |\n\n## ğŸ”„ Migration Strategy\n**Approach:** Incremental refactoring (backward compatible at each step)\n1. Phases 1-5: Create utilities without using them â†’ 0 risk\n2. Phase 6-7: Refactor one function at a time â†’ Test each change\n3. Each phase can be committed separately\n4. Rollback plan: Revert specific commit if issues arise\n\n## ğŸ§ª Testing Strategy\n**Unit Tests:** Test each utility function independently\n**Integration Tests:** All existing API tests must pass\n**Manual Testing:** Test with different user roles (teacher, admin, superadmin)\n\n## ğŸ› Known Risks \u0026 Mitigation\n**Risk 1:** Breaking existing functionality\n**Mitigation:** Keep all public APIs unchanged, test each phase\n\n**Risk 2:** Performance regression\n**Mitigation:** Measure query counts before/after, use same Supabase clients\n\n**Risk 3:** Type errors in complex transformations\n**Mitigation:** Strong typing for all utilities, unit tests for edge cases\n\n## ğŸ“… Timeline Estimate\n| Phase | Estimated Time | Risk Level |\n|-------|----------------|------------|\n| Phase 1 | 2 hours | Low |\n| Phase 2 | 1.5 hours | Low |\n| Phase 3 | 3 hours | Medium |\n| Phase 4 | 2.5 hours | Medium |\n| Phase 5 | 2 hours | Low |\n| Phase 6 | 3 hours | Medium |\n| Phase 7 | 4 hours | High |\n| Testing | 3 hours | - |\n| **Total** | **~21 hours** | **Medium** |\n\n## ğŸ“ Notes\n- This refactoring does NOT change any business logic\n- All RLS policies remain the same\n- Database queries are unchanged (only reorganized)\n- Existing SWR cache keys remain compatible\n- No changes to UI components needed\n\n## ğŸ”— Related Files\n**Files to Modify:**\n- src/app/(admin)/absensi/actions.ts\n\n**Files to Create:**\n- src/lib/utils/dataTransformers.ts\n- src/lib/utils/queryHelpers.ts\n- src/app/(admin)/absensi/utils/authHelpers.ts\n- src/app/(admin)/absensi/utils/meetingFilters.ts\n- src/app/(admin)/absensi/utils/statsCalculators.ts\n- src/app/(admin)/absensi/utils/meetingQueries.ts\n\n**Files to Reference:**\n- src/lib/utils/classHelpers.ts (existing patterns)\n- src/lib/utils/batchFetching.ts (existing patterns)\n- src/app/(admin)/laporan/actions.ts (similar complexity)\n\n## âœ¨ Future Improvements\nAfter this refactoring:\n1. Apply same patterns to laporan/actions.ts (~900 lines)\n2. Extract common attendance filtering to shared utilities\n3. Add performance monitoring/telemetry\n4. Implement request caching at server action level","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T07:42:57.808618+07:00","created_by":"abuabdirohman","updated_at":"2026-01-10T07:42:57.808618+07:00","labels":["absensi","code-quality","refactoring","technical-debt"]}
{"id":"sm-qrt","title":"Setup unit testing infrastructure with Vitest","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:08.430507+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:32:08.430507+07:00"}
{"id":"sm-x9a","title":"Enhancement: Show kelompok name in class label for desa-level users in AssignStudentsModal","description":"\n## Problem\nWhen desa-level admin users assign students to classes in AssignStudentsModal, the class dropdown only shows class names without kelompok information. This makes it difficult to identify which kelompok each class belongs to, especially when multiple kelompoks have classes with the same name.\n\n## Location\nFile: src/app/(admin)/users/siswa/components/AssignStudentsModal.tsx\nLine: 165\nCurrent code:\n```typescript\nlabel: cls.name,\n```\n\n## Expected Behavior\nFor desa-level users (admin_desa), the class label should include kelompok name:\n- Format: \"{kelompok_name} - {class_name}\"\n- Example: \"Kelompok A - Pra Nikah\" instead of just \"Pra Nikah\"\n\nFor other user levels (superadmin, admin_daerah, admin_kelompok, teacher):\n- Keep current behavior (class name only)\n\n## Implementation Notes\n1. Check user profile level (isAdminDesa from @/lib/userUtils)\n2. Ensure classes data includes kelompok relation\n3. Update label conditionally based on user level\n4. Test with desa-level admin account\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T20:21:10.443129+07:00","created_by":"abuabdirohman","updated_at":"2026-02-04T20:35:08.245938+07:00","closed_at":"2026-02-04T20:35:08.245938+07:00","close_reason":"Implemented conditional label for class dropdown. For admin_desa users, label shows 'Kelompok Name - Class Name', for other users shows 'Class Name' only."}
