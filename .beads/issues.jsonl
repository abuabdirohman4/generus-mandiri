{"id":"sm-04g","title":"Bug: Filter halaman organisasi tidak berjalan","description":"## üêõ Problem\nFilter pada halaman organisasi tidak berfungsi dengan baik.\n\n## üìç Location\nHalaman: /organisasi\n\n## üîç Expected Behavior\nFilter seharusnya dapat menyaring data organisasi berdasarkan kriteria yang dipilih (Daerah, Desa, Kelompok).\n\n## ‚ùå Current Behavior\nFilter tidak berjalan/tidak memberikan hasil yang diharapkan.\n\n## üß™ Steps to Reproduce\n1. Buka halaman Organisasi\n2. Coba gunakan filter (Daerah/Desa/Kelompok)\n3. Observe: Filter tidak bekerja\n\n## üîß Possible Causes\n- Filter logic tidak terhubung dengan data fetching\n- State management untuk filter tidak ter-update\n- Query parameters tidak ter-apply ke API call\n- RLS policy issue\n\n## üí° Investigation Needed\n- [ ] Check filter state management (Zustand/React state)\n- [ ] Verify API calls include filter parameters\n- [ ] Test filter with different organizational levels\n- [ ] Check console for errors\n- [ ] Review RLS policies for organisasi tables\n\n## üìù Related Files\n- src/app/(admin)/organisasi/page.tsx\n- src/app/(admin)/organisasi/components/\n- src/app/(admin)/organisasi/hooks/\n- src/app/(admin)/organisasi/stores/\n\n## üè∑Ô∏è Version\nv1.10.2","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T08:22:13.344661+07:00","created_by":"abuabdirohman","updated_at":"2026-01-10T08:22:13.344661+07:00","labels":["bug","filter","organisasi","ui"]}
{"id":"sm-37l","title":"Document unit testing strategy in CLAUDE.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:10.403811+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T10:25:16.505951+07:00","closed_at":"2026-02-10T10:25:16.505951+07:00","close_reason":"Completed comprehensive unit testing documentation in CLAUDE.md. Includes: testing stack (Vitest), priority strategy, setup instructions, example tests, coverage goals, and 3-phase roadmap.","dependencies":[{"issue_id":"sm-37l","depends_on_id":"sm-qrt","type":"blocks","created_at":"2026-02-10T08:32:49.584523+07:00","created_by":"abuabdirohman"}]}
{"id":"sm-6gn","title":"Write tests for utility functions (Priority 1)","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:12.306887+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:32:12.306887+07:00","dependencies":[{"issue_id":"sm-6gn","depends_on_id":"sm-qrt","type":"blocks","created_at":"2026-02-10T08:32:58.235922+07:00","created_by":"abuabdirohman"}]}
{"id":"sm-8yf","title":"Feature: Student management actions (Archive, Transfer, Soft Delete, Hard Delete) with teacher permissions","description":"## Overview\nImplement student lifecycle management with 3 main actions: **Archive** (with status), **Transfer**, and **Delete** (soft/hard) with role-based permissions.\n\n## üéØ Clarified Requirements (After Discussion)\n\n### Key Decisions:\n1. **Archive vs Soft Delete ARE DIFFERENT**:\n   - Archive = Student is VALID but inactive (graduated, transferred out)\n   - Soft Delete = Student data is ERROR/INVALID (wrong entry, test data)\n\n2. **Simplified Status System**:\n   - `active` - Currently studying\n   - `graduated` - Completed program successfully\n   - `inactive` - Not active (transferred out, on leave, etc.)\n   - (No 'archived' status - use graduated/inactive)\n\n3. **Archive Actions**:\n   - Archive as **Graduated** ‚Üí `status: 'graduated'`\n   - Archive as **Inactive** ‚Üí `status: 'inactive'`\n\n## üìã Features to Implement\n\n### 1. Archive Student (with Status)\n**Purpose**: Mark student as no longer active, but keep valid historical data\n**Database**: Add `status` enum field to students table\n**Use Cases**:\n- Student **graduated** from program (Pra Nikah, Remaja, Orang Tua)\n- Student **transferred** to organization outside system\n- Student on **long-term leave** or moved away\n\n**Implementation**:\n```sql\nALTER TABLE students ADD COLUMN status VARCHAR(20) DEFAULT 'active'\n  CHECK (status IN ('active', 'graduated', 'inactive'));\nALTER TABLE students ADD COLUMN archived_at TIMESTAMPTZ;\nALTER TABLE students ADD COLUMN archived_by UUID REFERENCES profiles(id);\nALTER TABLE students ADD COLUMN archive_notes TEXT;\n```\n\n**Permissions**:\n- ‚úÖ Superadmin: Can archive any student\n- ‚úÖ Admin (all levels): Can archive students in their hierarchy\n- ‚úÖ Teacher: Can archive ONLY with `can_archive_students` permission\n- ‚ùå Student: No access\n\n**UI**:\n- Archive modal with status selector:\n  - üìö Mark as Graduated (completed program)\n  - üì¶ Mark as Inactive (transferred/left)\n- Optional notes field\n- Confirmation dialog\n\n**Business Rules**:\n- Archived students (graduated/inactive) hidden from active lists\n- **Still appear in historical reports** (data is valid!)\n- Can be unarchived (change status back to 'active')\n- Show in alumni view (filter: status = 'graduated')\n\n---\n\n### 2. Transfer Student (Internal)\n**Purpose**: Move student to different class/organization within system\n**Database**: Update student's org fields + `student_classes` junction table\n\n**Use Cases**:\n- Student moves to different desa within same daerah\n- Student switches class (Remaja Kelas 1 ‚Üí Remaja Kelas 2)\n- Organization restructuring\n\n**Implementation**:\n```sql\nALTER TABLE students ADD COLUMN transferred_from JSONB;\n-- Example: {\"from_desa_id\": \"xxx\", \"from_kelompok_id\": \"yyy\", \"date\": \"2025-01-01\"}\n```\n\n**Permissions**:\n- ‚úÖ Superadmin: Transfer to any organization/class\n- ‚úÖ Admin Daerah: Transfer within daerah\n- ‚úÖ Admin Desa: Transfer within desa (between kelompoks)\n- ‚úÖ Admin Kelompok: Transfer between classes in kelompok\n- ‚ö†Ô∏è  Teacher: Transfer between own classes ONLY (with permission)\n\n**UI**:\n- Transfer modal with organization/class selectors\n- Show source and destination clearly\n- Batch transfer support (multiple students ‚Üí one destination)\n- Transfer effective date selector\n\n**Business Rules**:\n- Updates `daerah_id`, `desa_id`, `kelompok_id`, `class_id`\n- Updates `student_classes` junction table\n- Keeps all attendance history (student_id unchanged)\n- Logs transfer in `transferred_from` JSONB field\n- Status remains 'active' after transfer\n\n---\n\n### 3. Soft Delete (Restorable)\n**Purpose**: Hide INVALID/ERROR student data (can be restored)\n**Database**: Add `deleted_at` timestamp (already exists in current schema)\n\n**Use Cases**:\n- Wrong student entry (typo name, duplicate)\n- Test data that needs cleanup\n- Accidental creation\n\n**Permissions**:\n- ‚úÖ Superadmin: Can soft delete any student\n- ‚úÖ Admin: Can soft delete students in their hierarchy\n- ‚ö†Ô∏è  Teacher: Can soft delete ONLY with `can_soft_delete_students` permission\n- ‚ùå Student: No access\n\n**UI**:\n- \"Delete\" button with confirmation\n- Separate \"Deleted Students\" section\n- \"Restore\" button in deleted view\n\n**Business Rules**:\n- **Hidden from ALL views** (including historical reports)\n- Data marked as invalid/error\n- Can be restored within retention period (e.g., 90 days)\n- Auto-cleanup after retention period (optional)\n\n---\n\n### 4. Hard Delete (Permanent)\n**Purpose**: Permanently remove data (GDPR, final cleanup)\n**Database**: DELETE from students table (cascade to related tables)\n\n**Use Cases**:\n- GDPR data deletion request\n- Final cleanup of old soft-deleted data\n- Remove duplicate entries permanently\n\n**Permissions**:\n- ‚úÖ Superadmin ONLY\n- ‚ùå All other roles: No access\n\n**UI**:\n- Only available in \"Deleted Students\" view (must soft delete first)\n- **Double confirmation** (\"Type DELETE to confirm\")\n- Shows impact summary (attendance logs, reports affected)\n- Optional: Require admin password re-entry\n\n**Business Rules**:\n- **Must be soft deleted first** (2-step process)\n- Cascade deletes:\n  - `student_classes` mappings\n  - `attendance_logs` (or archive to history table)\n  - `student_reports`, `student_section_grades`, etc.\n- **IRREVERSIBLE** - cannot be undone\n- Logged in audit trail with reason\n\n---\n\n## üóÑÔ∏è Database Schema Changes\n\n```sql\n-- Students table\nALTER TABLE students\n  ADD COLUMN status VARCHAR(20) DEFAULT 'active'\n    CHECK (status IN ('active', 'graduated', 'inactive')),\n  ADD COLUMN archived_at TIMESTAMPTZ,\n  ADD COLUMN archived_by UUID REFERENCES profiles(id),\n  ADD COLUMN archive_notes TEXT,\n  ADD COLUMN transferred_from JSONB;\n  -- deleted_at already exists\n\n-- Profiles table - Teacher permissions\nALTER TABLE profiles\n  ADD COLUMN permissions JSONB DEFAULT '{\n    \"can_archive_students\": false,\n    \"can_transfer_students\": false,\n    \"can_soft_delete_students\": false,\n    \"can_hard_delete_students\": false\n  }'::jsonb;\n\n-- Indexes\nCREATE INDEX idx_students_status ON students(status);\nCREATE INDEX idx_students_archived ON students(archived_at) WHERE archived_at IS NOT NULL;\nCREATE INDEX idx_students_deleted ON students(deleted_at) WHERE deleted_at IS NOT NULL;\n```\n\n## üîê Permission System (Teacher Settings)\n\n**Location**: `/users/guru` page (Teacher management)\n\n**UI Section**: \"Izin Kelola Siswa\" (Student Management Permissions)\n\n**Stored in**: `profiles.permissions` JSONB field\n\n**Default Permissions**:\n- Superadmin: All permissions (hardcoded)\n- Admin (all levels): All permissions (hardcoded)\n- Teacher: None by default, configurable by admin\n- Student: No permissions\n\n---\n\n## üõ†Ô∏è Implementation Tasks\n\n### Phase 1: Database Schema (Priority: High)\n- [ ] Create migration for `status`, `archived_at`, `archived_by`, `archive_notes`, `transferred_from`\n- [ ] Create migration for `profiles.permissions` JSONB field\n- [ ] Add indexes for performance\n- [ ] Update RLS policies if needed\n\n### Phase 2: Server Actions (Priority: High)\n- [ ] `archiveStudent(studentId, status: 'graduated'|'inactive', notes)`\n- [ ] `unarchiveStudent(studentId)` - Set status back to 'active'\n- [ ] `transferStudent(studentId, targetOrgIds, transferDate)`\n- [ ] `softDeleteStudent(studentId)` - Set deleted_at (already exists, update)\n- [ ] `restoreStudent(studentId)` - Clear deleted_at\n- [ ] `hardDeleteStudent(studentId, confirmToken)` - Permanent delete\n- [ ] Add permission checks in all actions\n- [ ] Update `getAllStudents()` to filter by status (exclude graduated/inactive by default)\n- [ ] Add `getArchivedStudents()`, `getDeletedStudents()`\n\n### Phase 3: Permission Management UI (Priority: Medium)\n- [ ] Add \"Izin Kelola Siswa\" section in Teacher page (`/users/guru`)\n- [ ] Create `TeacherPermissionsCheckboxes` component\n- [ ] Add `updateTeacherPermissions(teacherId, permissions)` action\n- [ ] Show permission badges in teacher table\n\n### Phase 4: Student Action UI (Priority: Medium)\n- [ ] Create `ArchiveStudentModal` - Select status (graduated/inactive) + notes\n- [ ] Create `TransferStudentModal` - Select destination org/class\n- [ ] Update `DeleteStudentModal` - Improve confirmation flow\n- [ ] Create `HardDeleteConfirmDialog` - Double confirmation\n- [ ] Add \"Archived Students\" filter toggle (show graduated/inactive)\n- [ ] Add \"Deleted Students\" section with restore buttons\n\n### Phase 5: Access Control \u0026 Business Logic (Priority: High)\n- [ ] Implement permission checks: `checkUserPermission(userId, 'can_archive_students')`\n- [ ] Filter students by status in queries (default: active only)\n- [ ] Update reports to handle archived students (include in historical data)\n- [ ] Handle cascade deletes for hard delete\n- [ ] Validate transfer boundaries (org hierarchy)\n\n### Phase 6: Testing (Priority: High)\n- [ ] Test archive/unarchive flow (graduated vs inactive)\n- [ ] Test transfer within same desa\n- [ ] Test transfer across desa boundaries\n- [ ] Test soft delete + restore\n- [ ] Test hard delete cascade\n- [ ] Test teacher permissions (with and without)\n- [ ] Test edge cases (archive deleted student, etc.)\n\n---\n\n## üìä Success Criteria\n\n‚úÖ Admin can archive student as \"Graduated\" or \"Inactive\"\n‚úÖ Archived students hidden from active lists but appear in historical reports\n‚úÖ Transfer updates org fields and maintains attendance history\n‚úÖ Soft delete hides from all views (including reports)\n‚úÖ Hard delete requires superadmin + double confirmation\n‚úÖ Teachers can only manage students with granted permissions\n‚úÖ No orphaned data after hard delete\n\n---\n\n## üö® Edge Cases\n\n1. **Archive already archived student** ‚Üí Show current status, allow status change\n2. **Transfer deleted student** ‚Üí Not allowed, must restore first\n3. **Hard delete active student** ‚Üí Not allowed, must soft delete first\n4. **Teacher archives without permission** ‚Üí Show access denied\n5. **Restore student to deleted class** ‚Üí Handle gracefully (unassign from class)\n6. **Transfer to non-existent organization** ‚Üí Validate target exists and accessible\n\n---\n\n## üîó Related Files\n\n**Server Actions**:\n- `src/app/(admin)/users/siswa/actions.ts`\n\n**Components** (NEW):\n- `src/app/(admin)/users/siswa/components/ArchiveStudentModal.tsx`\n- `src/app/(admin)/users/siswa/components/TransferStudentModal.tsx`\n- `src/app/(admin)/users/siswa/components/HardDeleteConfirmDialog.tsx`\n\n**Components** (UPDATE):\n- `src/app/(admin)/users/siswa/components/DeleteStudentModal.tsx`\n- `src/app/(admin)/users/guru/page.tsx` (add permissions UI)\n\n**Utilities**:\n- `src/lib/accessControlServer.ts`\n\n**Database**:\n- `supabase/migrations/`\n\n---\n\n## üìù Notes\n\n- This is a LARGE feature - consider breaking into sub-tasks\n- Maintain backward compatibility with existing soft/hard delete\n- Consider audit logging for compliance\n- GDPR: Allow data export before hard delete\n- Consider retention policy (auto-delete after X days)","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-04T21:17:45.025032+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T10:25:02.507744+07:00"}
{"id":"sm-8yt","title":"Bug: DataFilter layout for 3 filters not aligned properly for admin desa","description":"\n## Problem\nWhen admin_desa users view pages with DataFilter showing 3 filters (e.g., Kelompok, Kelas, Jenis Kelamin), the layout is not properly aligned. The filters appear in different rows with inconsistent widths.\n\n## Current Behavior\n- All 3 filters appear on separate rows\n- Filter widths are not equal\n- Layout looks messy and unprofessional\n\n## Expected Behavior\n- 2 filters on top row (equal width)\n- 1 filter on bottom row (full width on mobile, equal width on desktop)\n- All filters should be aligned and have consistent spacing\n\n## Location\nFile: src/components/shared/DataFilter.tsx\nLines: 570-598\n\n## Current Code Issue\nLine 576 uses `grid-cols-2 md:grid-cols-4` for filterCount 2-4, which doesn't handle 3 filters properly.\nThe `getFilterClass` function attempts to fix this with col-span, but the base grid is incorrect.\n\n## Attempted Fix (Reverted)\nChanged line 576 to separate cases:\n- filterCount === 2: grid-cols-2 md:grid-cols-4\n- filterCount === 3: grid-cols-2 md:grid-cols-3\n- filterCount === 4: grid-cols-2 md:grid-cols-4\n\nBut this was reverted by linter/prettier.\n\n## Solution Needed\nNeed to implement proper grid layout for 3 filters that:\n1. Works on mobile (2 cols, last spans 2)\n2. Works on desktop (3 equal cols)\n3. Survives linter/prettier formatting\n","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-04T21:16:35.534343+07:00","created_by":"abuabdirohman","updated_at":"2026-02-04T21:16:35.534343+07:00"}
{"id":"sm-a0y","title":"Refactor: Optimize absensi/actions.ts (2215 ‚Üí ~900 lines)","description":"Mengurangi kompleksitas dan duplikasi kode di src/app/(admin)/absensi/actions.ts dengan memecah logika berulang menjadi utility functions yang reusable.\n\n## üéØ Objectives\n- Reduce from 2215 lines to ~900 lines (-59%)\n- Eliminate ~1300 lines of duplicated code (-96%)\n- Split getMeetingsWithStats (986 lines ‚Üí ~200 lines per function)\n- Improve testability and maintainability\n\n## üìä Problem Analysis\n\n### Duplicated Code Identified:\n1. **Data Transformation Logic** (~360 lines duplicate)\n   - Transform array to object (kelompok/desa/daerah): 12x repetitions\n   - Build class names array: 6x repetitions\n   - Build allClasses array: 4x repetitions\n\n2. **Filter Logic** (~200 lines duplicate)\n   - Teacher class filtering: 3x repetitions\n   - Admin hierarchy filtering: 3x repetitions\n   - Pengajar access logic: 4x repetitions\n\n3. **Stats Calculation** (~300 lines duplicate)\n   - Attendance percentage calculation: 3x repetitions\n   - Student filtering by role: 3x repetitions\n   - Stats enrichment: 3x repetitions\n\n4. **Query Patterns** (~150 lines duplicate)\n   - Fetch classes with hierarchy: 6x repetitions\n   - Build class maps: 5x repetitions\n   - Fetch student-class mappings: 3x repetitions\n\n5. **Auth \u0026 Validation** (~100 lines duplicate)\n   - User + profile fetch: 8x repetitions\n   - Teacher class validation: 2x repetitions\n   - Student validation: 3x repetitions\n\n## üîß Implementation Phases\n\n### Phase 1: Extract Data Transformation Utilities (Reduction: ~310 lines)\n**Create:** src/lib/utils/dataTransformers.ts\n**Functions:**\n- transformClassWithHierarchy(classData)\n- transformMeetingClasses(meeting)\n- buildAllClassesArray(meeting, allClassesMap)\n- buildClassNamesArray(meeting, classNameMap)\n\n### Phase 2: Extract Query Helpers (Reduction: ~140 lines)\n**Create:** src/lib/utils/queryHelpers.ts\n**Functions:**\n- fetchClassesWithHierarchy(supabase, classIds)\n- buildClassMaps(classesData)\n- fetchStudentClassMappings(supabase, studentIds)\n\n### Phase 3: Extract Meeting Filter Logic (Reduction: ~340 lines)\n**Create:** src/app/(admin)/absensi/utils/meetingFilters.ts\n**Functions:**\n- filterMeetingsByTeacherClasses(meetings, teacherClassIds, ...)\n- filterMeetingsByAdminLevel(meetings, profile, ...)\n- checkPengajarAccess(meeting, teacherKelompokIds, classDetailsMap)\n\n### Phase 4: Extract Stats Calculation (Reduction: ~400 lines)\n**Create:** src/app/(admin)/absensi/utils/statsCalculators.ts\n**Functions:**\n- calculateMeetingStats(meeting, attendanceByMeeting, relevantStudentIds)\n- processRoleBasedStudentFilter(meeting, profile, ...)\n- enrichMeetingsWithStats(meetings, attendanceByMeeting, ...)\n\n### Phase 5: Extract Auth \u0026 Validation (Reduction: ~140 lines)\n**Create:** src/app/(admin)/absensi/utils/authHelpers.ts\n**Functions:**\n- getCurrentUserWithProfile(supabase, fields?)\n- validateTeacherClasses(adminClient, teacherId, classIds)\n- validateStudentSelection(adminClient, classIds, studentIds)\n\n### Phase 6: Split getMeetingsWithStats (Reduction: ~200 lines)\n**Create:** src/app/(admin)/absensi/utils/meetingQueries.ts\n**Structure:**\n- getMeetingsWithStats() - Main orchestrator (~100 lines)\n- getTeacherMeetingsWithStats() - Teacher-specific (~200 lines)\n- getAdminMeetingsWithStats() - Admin-specific (~180 lines)\n- getFallbackMeetingsWithStats() - Fallback (~100 lines)\n\n### Phase 7: Refactor actions.ts\n**Update all functions to use new utilities:**\n- createMeeting - Use authHelpers \u0026 validation\n- getMeetingById - Use dataTransformers\n- updateMeeting - Use authHelpers \u0026 validation\n- getMeetingsWithStats - Import from meetingQueries\n- getStudentsFromSnapshot - Use dataTransformers\n\n## üìÇ New File Structure\nsrc/lib/utils/\n‚îú‚îÄ‚îÄ dataTransformers.ts [NEW - ~150 lines]\n‚îú‚îÄ‚îÄ queryHelpers.ts [NEW - ~120 lines]\n\nsrc/app/(admin)/absensi/utils/\n‚îú‚îÄ‚îÄ authHelpers.ts [NEW - ~100 lines]\n‚îú‚îÄ‚îÄ meetingFilters.ts [NEW - ~200 lines]\n‚îú‚îÄ‚îÄ statsCalculators.ts [NEW - ~180 lines]\n‚îú‚îÄ‚îÄ meetingQueries.ts [NEW - ~150 lines]\n\nsrc/app/(admin)/absensi/\n‚îî‚îÄ‚îÄ actions.ts [REFACTORED - ~900 lines]\n\n**Total New Files:** 6\n**Total New LOC:** ~900 lines (reusable utilities)\n**Total Removed LOC:** ~1300 lines (duplications)\n**Net Reduction:** -400 lines + better modularity\n\n## ‚úÖ Acceptance Criteria\n- [ ] No duplicated logic (\u003c 50 lines duplication)\n- [ ] All functions \u003c 200 lines\n- [ ] All utilities have TypeScript interfaces\n- [ ] All utilities have JSDoc comments\n- [ ] All existing tests pass\n- [ ] Unit tests for new utility functions\n- [ ] No performance regression\n- [ ] Type checking passes (npm run type-check)\n- [ ] No new ESLint warnings\n- [ ] All public API signatures unchanged\n- [ ] Existing SWR hooks still work\n\n## üìä Success Metrics\n| Metric | Before | After | Target |\n|--------|--------|-------|--------|\n| Total LOC (actions.ts) | 2215 | ~900 | -59% |\n| Duplicated code | ~1300 | ~50 | -96% |\n| Longest function | 986 lines | ~200 lines | -80% |\n| Cyclomatic complexity | High | Low | ‚úÖ |\n| Utility files | 3 | 9 | Modular |\n\n## üîÑ Migration Strategy\n**Approach:** Incremental refactoring (backward compatible at each step)\n1. Phases 1-5: Create utilities without using them ‚Üí 0 risk\n2. Phase 6-7: Refactor one function at a time ‚Üí Test each change\n3. Each phase can be committed separately\n4. Rollback plan: Revert specific commit if issues arise\n\n## üß™ Testing Strategy\n**Unit Tests:** Test each utility function independently\n**Integration Tests:** All existing API tests must pass\n**Manual Testing:** Test with different user roles (teacher, admin, superadmin)\n\n## üêõ Known Risks \u0026 Mitigation\n**Risk 1:** Breaking existing functionality\n**Mitigation:** Keep all public APIs unchanged, test each phase\n\n**Risk 2:** Performance regression\n**Mitigation:** Measure query counts before/after, use same Supabase clients\n\n**Risk 3:** Type errors in complex transformations\n**Mitigation:** Strong typing for all utilities, unit tests for edge cases\n\n## üìÖ Timeline Estimate\n| Phase | Estimated Time | Risk Level |\n|-------|----------------|------------|\n| Phase 1 | 2 hours | Low |\n| Phase 2 | 1.5 hours | Low |\n| Phase 3 | 3 hours | Medium |\n| Phase 4 | 2.5 hours | Medium |\n| Phase 5 | 2 hours | Low |\n| Phase 6 | 3 hours | Medium |\n| Phase 7 | 4 hours | High |\n| Testing | 3 hours | - |\n| **Total** | **~21 hours** | **Medium** |\n\n## üìù Notes\n- This refactoring does NOT change any business logic\n- All RLS policies remain the same\n- Database queries are unchanged (only reorganized)\n- Existing SWR cache keys remain compatible\n- No changes to UI components needed\n\n## üîó Related Files\n**Files to Modify:**\n- src/app/(admin)/absensi/actions.ts\n\n**Files to Create:**\n- src/lib/utils/dataTransformers.ts\n- src/lib/utils/queryHelpers.ts\n- src/app/(admin)/absensi/utils/authHelpers.ts\n- src/app/(admin)/absensi/utils/meetingFilters.ts\n- src/app/(admin)/absensi/utils/statsCalculators.ts\n- src/app/(admin)/absensi/utils/meetingQueries.ts\n\n**Files to Reference:**\n- src/lib/utils/classHelpers.ts (existing patterns)\n- src/lib/utils/batchFetching.ts (existing patterns)\n- src/app/(admin)/laporan/actions.ts (similar complexity)\n\n## ‚ú® Future Improvements\nAfter this refactoring:\n1. Apply same patterns to laporan/actions.ts (~900 lines)\n2. Extract common attendance filtering to shared utilities\n3. Add performance monitoring/telemetry\n4. Implement request caching at server action level","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T07:42:57.808618+07:00","created_by":"abuabdirohman","updated_at":"2026-01-10T07:42:57.808618+07:00","labels":["absensi","code-quality","refactoring","technical-debt"]}
{"id":"sm-qrt","title":"Setup unit testing infrastructure with Vitest","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-10T08:32:08.430507+07:00","created_by":"abuabdirohman","updated_at":"2026-02-10T08:32:08.430507+07:00"}
{"id":"sm-x9a","title":"Enhancement: Show kelompok name in class label for desa-level users in AssignStudentsModal","description":"\n## Problem\nWhen desa-level admin users assign students to classes in AssignStudentsModal, the class dropdown only shows class names without kelompok information. This makes it difficult to identify which kelompok each class belongs to, especially when multiple kelompoks have classes with the same name.\n\n## Location\nFile: src/app/(admin)/users/siswa/components/AssignStudentsModal.tsx\nLine: 165\nCurrent code:\n```typescript\nlabel: cls.name,\n```\n\n## Expected Behavior\nFor desa-level users (admin_desa), the class label should include kelompok name:\n- Format: \"{kelompok_name} - {class_name}\"\n- Example: \"Kelompok A - Pra Nikah\" instead of just \"Pra Nikah\"\n\nFor other user levels (superadmin, admin_daerah, admin_kelompok, teacher):\n- Keep current behavior (class name only)\n\n## Implementation Notes\n1. Check user profile level (isAdminDesa from @/lib/userUtils)\n2. Ensure classes data includes kelompok relation\n3. Update label conditionally based on user level\n4. Test with desa-level admin account\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-04T20:21:10.443129+07:00","created_by":"abuabdirohman","updated_at":"2026-02-04T20:35:08.245938+07:00","closed_at":"2026-02-04T20:35:08.245938+07:00","close_reason":"Implemented conditional label for class dropdown. For admin_desa users, label shows 'Kelompok Name - Class Name', for other users shows 'Class Name' only."}
